<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Register</title>
	<link href="/styles.css" rel="stylesheet">
</head>

<body class="bg-gray-100 min-h-screen flex items-center justify-center">
	<div class="bg-white p-8 rounded-lg shadow-md w-full max-w-md">
		<h2 class="mt-10 text-center text-2xl font-bold text-gray-900">
			Buat Akun Baru
		</h2>

		<% if (typeof error !=='undefined' && error) { %>
			<div class="mt-4 bg-red-100 border-l-4 border-red-500 text-red-700 p-4">
				<p>
					<%= error %>
				</p>
			</div>
		<% } %>

		<% if (typeof success !=='undefined' && success) { %>
            <div class="bg-teal-100 border-l-4 border-teal-500 text-teal-700 p-4 mb-4">
                <p> <%= success %> </p>
            </div>
        <% } %>


				<form class="space-y-6" action="/register" method="POST">
					<div>
						<label for="username" class="block text-sm font-medium text-gray-700">
							Username
						</label>
						<div class="mt-2">
							<input id="username" name="username" type="text" required
								value="<%= formData ? formData.username : '' %>"
								class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
						</div>
					</div>

					<div>
						<label for="password" class="block text-sm font-medium text-gray-700">
							Password
						</label>
						<div class="mt-2">
							<input id="password" name="password" type="password" required
								class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
						</div>
					</div>

					<div>
						<label for="role" class="block text-sm font-medium text-gray-700">
							Role
						</label>
						<div class="mt-2">
							<select id="role" name="role"
								class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
								<option value="mahasiswa" <%=formData && formData.role==='mahasiswa' ? 'selected' : ''
									%>
									>Mahasiswa</option>
								<option value="dosen" <%=formData && formData.role==='dosen' ? 'selected' : '' %>>Dosen
								</option>
							</select>
						</div>

						<!-- Elemen tambahan untuk mahasiswa -->
						<div id="dosenSelection" class="mt-4 hidden">
							<label for="dosen" class="block text-sm font-medium text-gray-700">
								Pilih Dosen Pembimbing
							</label>
							<div class="mt-2 relative">
								<select id="dosen" name="dosen_id"
									class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
									<% if (dosens && dosens.length) { %>
										<% dosens.forEach(dosen=> { %>
											<option value="<%= dosen.id %>" <%=formData && formData.dosen_id==dosen.id
												? 'selected' : '' %>>
												<!-- <%= dosen.username %> - <%= dosen.id %> -->
												<%= dosen.username %>
											</option>
											<% }); %>
												<% } else { %>
													<option value="">Tidak ada dosen tersedia</option>
													<% } %>
								</select>
							</div>
						</div>
					</div>

					<div>
						<button type="submit"
							class="flex w-full justify-center rounded-md bg-indigo-600 px-3 py-1.5 text-sm font-semibold leading-6 text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600">
							Daftar
						</button>
					</div>
				</form>

				<p class="mt-10 text-center text-sm text-gray-500">
					Sudah punya akun?
					<a href="/login" class="font-semibold leading-6 text-indigo-600 hover:text-indigo-500">
						Masuk disini
					</a>
				</p>
	</div>

	<script>
		document.getElementById('role').addEventListener('change', function () {
			const dosenSelection = document.getElementById('dosenSelection');
			if (this.value === 'mahasiswa') {
				dosenSelection.classList.remove('hidden');
			} else {
				dosenSelection.classList.add('hidden');
			}
		});

		// Panggil event handler saat halaman dimuat untuk menangani kasus ketika formData sudah ada
		document.addEventListener('DOMContentLoaded', function () {
			const roleSelect = document.getElementById('role');
			if (roleSelect.value === 'mahasiswa') {
				document.getElementById('dosenSelection').classList.remove('hidden');
			}
		});
	</script>
</body>

</html>